# 🎯 오늘 학습한 핵심 내용 TIL

# 📊 결측치 탐지 및 처리 (심화)

## 1. 🎯 데이터 생성 및 개요

실제 **전자상거래 데이터를 모사**하는 시뮬레이션 데이터 생성[1]
- 고객정보(나이, 성별, 도시), 구매행동, 만족도, 충성도, 카테고리별 구매 금액 포함

### 결측치 3가지 메커니즘 반영

- **MCAR (완전 무작위 결측)**: 예) 시스템 오류로 인한 임의 결측
- **MAR (조건부 결측)**: 예) 나이가 높을수록 만족도 응답 안 함
- **MNAR (비무작위 결측)**: 예) 고소득자 개인정보 비공개

### 이상치 생성

- 데이터 입력 오류(나이 999살)
- 비즈니스 이상치(VIP 고객의 매우 높은 구매액 등)
- 시스템 버그(음수값 등)

***

## 2. 🔍 결측치 메커니즘에 대한 이해

### MCAR (Missing Completely At Random)
- 결측 발생이 데이터 내 어떤 변수에도 의존하지 않음
- **분석에 편향을 주지 않아** 다루기 가장 간단함

### MAR (Missing At Random)
- 결측 발생이 관측된 다른 변수들에 조건부로 의존
- 예) 나이가 높을수록 만족도 응답 거부율 증가
- **해당 조건 변수들을 포함한** 분석/대체가 필요

### MNAR (Missing Not At Random)
- 결측 발생이 결측 변수 자체 값이나 미관측 요인에 의존
- 예) 고소득자가 개인정보를 비공개함
- **분석과 대체가 어려우며**, 민감도 분석 또는 특수 기법 필요

***

## 3. ⚖️ 결측치 대체법 선택 시 고려사항

### 평균 대체 (SimpleImputer)
- ✅ 가장 쉽고 빠름
- ⚠️ 하지만 분산 감소, 데이터 왜곡 초래 가능

### KNN 대체 (KNNImputer)
- ✅ 비슷한 데이터(근접 이웃)를 기준으로 자연스러운 대체 가능
- ⚠️ 계산 비용이 더 높음

### MICE 대체 (IterativeImputer)
- ✅ 다변량 회귀 모델을 반복 적용해 복잡한 변수 관계 반영
- ⚠️ 변수간 상관관계가 약하면 평균 대체와 비슷한 결과
- ⚠️ 계산 비용 가장 높고 구현 난이도 있음

### 💡 대체 후 평가 필수
- 분포, 통계량, 변수 간 상관관계 변화 점검
- **실제 분석 목적에 맞는** 대체법 선택 권장

***

## 4. 🚨 이상치 처리

**이상치는 데이터 분석 왜곡의 주요 원인**

### 이상치 유형
- 입력 오류(예: 나이 999)
- 비즈니스상 정상이나 극단값 (예: VIP 고객 구매액 매우 높음)
- 시스템 오류(예: 음수값)

### 이상치 처리 방법
- 삭제, 변환(로그, 제곱근), 제한(Winsorizing) 등
- **도메인 지식과 데이터 특성 고려 필수**
- 오늘은 이상치 생성과 탐지에 집중, 실제 처리 방법은 상황별 다름

***

## 5. 📈 결측값 패턴 분석 및 시각화

- 변수별 결측수/결측률 집계 및 출력
- **결측값 히트맵 시각화**로 전체 패턴 확인
- 변수별 결측률 바 차트
- 결측값 조합 패턴 상위 10개 빈도 분석
- 결측 여부(0/1)와 수치형 변수 간 **상관관계 히트맵**

***

## 6. 🔬 결측 메커니즘 진단 예시

- age 결측과 avg_order_value(구매액) 관계를 **카이제곱 검정**으로 분석
- 분위별 결측률 계산 및 p-value에 따른 **MAR/MCAR 판단**
- 만족도(satisfaction_score) 결측은 연령대, 성별별 결측률로 추가 분석

***

## 7. ✅ 대체 결과 비교 및 평가

- 결측 대체법별 변수 분포 **히스토그램 겹쳐 그려** 비교
- 주요 통계량(평균, 표준편차 등) 표 형태로 비교
- 변수 간 상관관계(예: 나이-구매액) **보존 평가**
- **대체 품질 평가는 분석 결과 신뢰도를 높이기 위해 필수**

### 💡 대체 품질 평가 시 유의사항
- 결측 비율이 높으면 **결과 왜곡 위험 커짐**
- 변수별, 데이터 특성별 **맞춤 대체법 적용 필요**
- 상관관계 보존뿐 아니라 **downstream 모델 성능 영향도 고려**

[1] https://learn.dailyalgo.kr/courses/ai-%EA%B8%B0%EB%B0%98-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%B6%84%EC%84%9D%EA%B0%80-%EC%96%91%EC%84%B1-%EA%B3%BC%EC%A0%95/23f611ac-3a00-805a-918b-f6878f5d19c8